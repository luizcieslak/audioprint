function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 04-Dec-2015 23:22:27.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 1xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = 280.955847247592;
x1_step1_gain = 0.0200973535582902;
x1_step1_ymin = -1;

% Layer 1
b1 = [140.57912410758990518;-137.17961094842698344;134.34342881164479877;-131.5151515896030503;-128.68686940376036887;-125.8585658283238331;123.03379753053759771;120.20403453656824411;117.37374954898079693;-114.54545457238589279;-111.71717171737299168;-108.88888888888992312;-106.06060606060606233;-103.23232323232322472;-100.40404040404040131;-97.575757575757577911;94.747474747474740298;91.919191919191916895;89.090909090909093493;-86.26262626262625588;83.434343434342792989;-80.606060605925236473;-77.777777815281751828;74.949505725596125671;72.125444818132450564;69.292762486466571659;-66.464646399814185429;-63.636363633603316714;60.808080808070563705;-57.979797979797979224;-55.151515151516534274;-52.323232322518009596;-49.494949669479588295;-46.666641404238362156;43.840777773302271214;41.01094107094947816;38.181824631828618521;35.353535391230792584;32.525250724666804558;-29.6964700935200554;26.787894418510617811;-24.054648604285386426;-21.203721022231448501;18.383846845499085987;15.555555577035356407;-12.727272731103813186;9.8989904570386695326;-7.0709884080866336475;4.3402499963074792078;-2.3129279096226031953;-2.3768403732599150402;4.2562488827844466854;7.0707640403064315748;9.8990229967187470805;12.676879079525404492;15.555977501099068405;18.377862144609562023;21.212246804373663167;-24.040402757494536701;26.868686871451362919;29.696971185083267386;32.524889632769017567;-35.321369315636751196;-38.181605146810866813;41.009923727843954566;-43.836413981837594633;-46.666442804413271972;49.494080137095991745;52.323253052030146648;55.151514867493105498;-57.979848232305940314;60.815636957708434807;63.643198166713361275;-66.464585619343765188;69.292928167315523069;-72.122017538282250371;-74.951811766462569153;-77.770148771844233693;-80.606222104729795319;-83.434581820682637954;86.291476000516979639;89.091036551986391601;91.919192203962921894;94.747474725948165997;97.575784893247671903;-100.40504953145588729;104.20288849444543189;105.9320069692761308;108.17562552273238907;111.71996758423638596;-114.54546706925665944;-117.37373734911729173;-120.20200350193903205;123.0229304346653123;-125.91167088675908303;-128.69734307396603867;-131.51522627798922827;-134.34343029309582107;137.17069224493837964;140.65265147846196214];
IW1_1 = [-139.42087589241009482;139.99210622329019316;-140.00000553178793439;139.99999992581300035;139.99999937327100952;140.00001751010958628;-139.99694516815384304;-139.99823910347302558;-139.99998935661210453;139.99999997645707595;139.99999999982412646;139.99999999999903366;140;140;140;140;-140;-140;-140;140;-140.00000000000028422;140.00000000006909318;139.99999998085112907;-139.99999449791425832;-139.9978388601646202;-140.0000851684158647;140.0000000331022818;140.00000000140937573;-140.00000000000517275;140;139.99999999999954525;140.00000000021935875;139.99999994639890133;140.00000775846629608;-139.99926534711784143;-139.9997438591964567;-139.99999803366685569;-139.99999998891672703;-140.00000034378919622;140.00009538429853251;-140.01542292799177858;139.99765246565010557;140.00137021130106518;-139.99999861975376803;-139.99999999649728011;140.00000000000085265;-139.99999999103789605;139.99999554287950332;-139.99845447160964795;140.00923588952699106;-139.99605495438572689;139.99994580468901972;139.99999989182791182;139.99999684081757323;140.00481680714440813;139.99995602704692033;140.00079210805901653;139.9999833520667778;-140.0000001700567509;139.99999999947561946;139.99999962655283525;140.00009106980755291;-140.00807224012592656;-140.00005371086879791;140.00005376807897051;-140.0006146895113659;-140.00007297983682975;140.00030434809386293;139.99999274285337947;140.00000011811752643;-139.99997804052927108;139.99669456840851467;139.99692298816219704;-140.00002740379704846;140.00000059007652453;-139.99957580774966459;-139.99877397393740353;-140.0042253167682702;-139.99991003316969795;-139.99985431998499052;139.98236937730354157;139.99992210611472387;139.99999982594627568;140.00000001582358777;139.9999797680285667;-139.99925261493928019;139.28120707934814959;140.10215824436795629;140.54969609795656993;139.99784529891320517;-139.9999903482812158;-140.00000002562083523;-140.00001493605935821;140.00659408344588996;-139.95223505896447591;-139.9905046582334478;-139.99993221264190879;-140.00000404453334113;140.00102492675938493;139.34734852153817997];

% Layer 2
b2 = -2.9802972590207104098;
LW2_1 = [-1.7529570562023406577 0.64979059366460345526 -0.08354934491882760883 0.52856550931596490983 0.5600022943198186276 0.34500691967779700819 -0.29637513730681791513 -0.11922524706834700114 -0.21710026433534726498 0.12459656183403805541 0.30616855721275143543 0.48185818720849971086 0.28877808384366410177 0.11926493122666124991 -0.028263552201226026239 -0.3172299573344964374 -0.30381624833069631464 0.17433017085292826232 0.42442563405245259389 0.15395600498758801877 0.36097039718780193907 -0.25582643170369995245 0.20095276218744939634 -0.20229531797050104291 -0.48016553701419845135 0.3157996680003283263 -0.068857808813334961395 -0.40510678180057829723 0.42836382732777295024 -0.10981124250870683001 0.082921910463910453171 -0.25736690188433147819 0.14708281226759872817 -0.13364580061169606395 0.01661229080165785299 0.1397258855131565114 0.080383427099978102537 0.015681705973834388773 0.50472277423761180426 -0.49750432853314074944 0.83049467049102654315 -0.16398786442516424811 -1.0659579163828749593 0.58601260003637256624 0.61425123631838585148 -1.1039008718859764091 0.60198494034374971928 -0.92652107415275253288 1.1246992696319675353 1.5903731709109167891 -0.055883932125507934652 1.0763968979843110407 1.2576417617725899056 0.43917122019004883882 1.0751056135215155685 0.27667525148974736471 0.36150580103833657164 0.14713000741042603359 -0.38419950303829258909 0.15100801758457738089 -0.072325733792187665849 0.48634437498160637547 -0.68119916230513133382 -0.48161166456775628131 0.18631017891571777234 -0.37317694431620185291 -0.20877436287226663891 0.21090914415435962903 -0.32975089275362079455 0.48897497641012249714 0.23937220939819392473 -0.30929153193003616762 -0.28687098687901163574 -0.4901470228827066733 0.10235401452348510953 0.19075574083850377338 0.28573276841955147498 -0.20115417281235795088 0.56057834856318877748 0.092204629374670402098 -0.67317454699774181837 -0.5930963198808032466 -0.43702355966349565319 0.093034087982126506544 -0.72595892141019291444 0.14336110484986622216 -1.6916560873700967615 -3.9309539609425820927 -0.77599802675681428532 1.109732267505056047 -1.2666989085858582076 -1.0269332297836568646 -1.0506443030345886669 1.2242701659258912184 -0.20882777980669042783 0.37663165039989066063 0.62656312374346667671 0.01619816375445981213 -0.028459654441264112951 -1.9874169472686860072];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
